<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DocsTrail</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500"
      rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/jgraph/styles/grapheditor.css" />
    <link href="https://fonts.cdnfonts.com/css/geneva" rel="stylesheet" />

    <script type="text/javascript" src="/jgraph/js/Init.js"></script>
    <script type="text/javascript" src="/jgraph/deflate/pako.min.js"></script>
    <script type="text/javascript" src="/jgraph/deflate/base64.js"></script>
    <script type="text/javascript" src="/jgraph/jscolor/jscolor.js"></script>
    <script
      type="text/javascript"
      src="/jgraph/sanitizer/sanitizer.min.js"></script>
    <script type="text/javascript" src="/jgraph/js/mxClient.js"></script>
    <script type="text/javascript" src="/jgraph/js/EditorUi.js"></script>
    <script type="text/javascript" src="/jgraph/js/Editor.js"></script>
    <script type="text/javascript" src="/jgraph/js/Sidebar.js"></script>
    <script type="text/javascript" src="/jgraph/js/Graph.js"></script>
    <script type="text/javascript" src="/jgraph/js/Format.js"></script>
    <script type="text/javascript" src="/jgraph/js/Shapes.js"></script>
    <script type="text/javascript" src="/jgraph/js/Actions.js"></script>
    <script type="text/javascript" src="/jgraph/js/Menus.js"></script>
    <script type="text/javascript" src="/jgraph/js/Toolbar.js"></script>
    <script type="text/javascript" src="/jgraph/js/Dialogs.js"></script>
  </head>
  <body class="mat-typography">
    <app-root></app-root>
    <script type="text/javascript">
      // Extends EditorUi to update I/O action states based on availability of backend
      (function () {
        var editorUiInit = EditorUi.prototype.init;

        EditorUi.prototype.init = function () {
          editorUiInit.apply(this, arguments);
          this.actions.get("save").setEnabled(true);
          this.actions.get("autosave").setEnabled(true);
          // this.actions.get("export").setEnabled(false);

          // Updates action states which require a backend
          // if (!Editor.useLocalStorage) {
          //   mxUtils.post(
          //     OPEN_URL,
          //     "",
          //     mxUtils.bind(this, function (req) {
          //       var enabled = req.getStatus() != 404;
          //       this.actions
          //         .get("open")
          //         .setEnabled(enabled || Graph.fileSupport);
          //       this.actions
          //         .get("import")
          //         .setEnabled(enabled || Graph.fileSupport);
          //       this.actions.get("save").setEnabled(enabled);
          //       this.actions.get("saveAs").setEnabled(enabled);
          //       this.actions.get("export").setEnabled(enabled);
          //     })
          //   );
          // }
        };

        // Adds required resources (disables loading of fallback properties, this can only
        // be used if we know that all keys are defined in the language specific file)
        mxResources.loadDefaultBundle = false;
        var bundle =
          mxResources.getDefaultBundle(RESOURCE_BASE, mxLanguage) ||
          mxResources.getSpecialBundle(RESOURCE_BASE, mxLanguage);

        // Fixes possible asynchronous requests
        mxUtils.getAll(
          [bundle, STYLE_PATH + "/default.xml"],
          function (xhr) {
            // Adds bundle text to resources
            mxResources.parse(xhr[0].getText());

            // Configures the default graph theme
            var themes = new Object();
            themes[Graph.prototype.defaultThemeName] =
              xhr[1].getDocumentElement();

            // Main
            const initializer = setInterval(() => {
              if (!document.getElementById("jgraph-canvas")) return;
              new EditorUi(new Editor(urlParams["chrome"] == "0", themes));
              clearInterval(initializer);
            }, 200);
            setTimeout(() => {
              // Safety turn off switch.
              clearInterval(initializer);
            }, 2000);
          },
          function () {
            document.body.innerHTML =
              '<center style="margin-top:10%;">Error loading resource files. Please check browser console.</center>';
          }
        );
      })();
    </script>
  </body>
</html>
